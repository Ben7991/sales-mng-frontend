<div class="sales-management-container">
  <div class="filter-section">
    <app-search
      [config]="salesSearchConfig"
      (searchTermChange)="onUserSearchTermChange($event)"
    />

    <div class="filter-actions">
      <app-button
        text="Filter"
        variant="outlined"
        [matMenuTriggerFor]="filterMenu"
        class="filter-button"
      >
        <mat-icon>expand_more</mat-icon>
      </app-button>

      <mat-menu #filterMenu="matMenu" class="popup-menu">
        <button mat-menu-item [matMenuTriggerFor]="roleMenu">
          Filter by customer
        </button>
        <button mat-menu-item [matMenuTriggerFor]="paidMenu">
          Filter by paid status
        </button>
        <button mat-menu-item [matMenuTriggerFor]="statusMenu">
          Filter by order status
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="filterStatus('')">Clear filter</button>
      </mat-menu>

      <!-- Role submenu -->
      <mat-menu #roleMenu="matMenu" class="popup-menu submenu">
        <button mat-menu-item (click)="filterStatus('ADMIN')">Admin</button>
        <button mat-menu-item (click)="filterStatus('SALES_PERSON')">Sale Person</button>
        <button mat-menu-item (click)="filterStatus('PROCUREMENT_OFFICER')">Procurement Person</button>
      </mat-menu>

      <mat-menu #paidMenu="matMenu" class="popup-menu submenu">
        <button mat-menu-item (click)="filterStatus('PAID')">Paid</button>
        <button mat-menu-item (click)="filterStatus('UNPAID')">Unpaid</button>
      </mat-menu>

      <!-- Status submenu -->
      <mat-menu #statusMenu="matMenu" class="popup-menu submenu">
        <button mat-menu-item (click)="filterStatus('ACTIVE')" >Active</button>
        <button mat-menu-item (click)="filterStatus('QUIT')">Quit</button>
        <button mat-menu-item (click)="filterStatus('FIRED')">Fired</button>
      </mat-menu>

      <app-button
        (click)="openCreateOrderModal()"
        icon="assets/addIcon.svg"
        [isIconButton]="true"
        text="create order"
        [styles]="{ height: '40px',width: '140px' }"
      />
    </div>
  </div>
</div>
@if (SalesManagementService.isLoadingOrders()) {
  <div class="loader">
    <mat-spinner diameter="50"></mat-spinner>
  </div>
}
@else {
  <app-table
    [columns]="tableColumns"
    [data]="SalesManagementService.orders() ?? []"
    [actions]="tableActions"
    [showCheckboxes]="false"
    [showPagination]="true"
    [pageSize]="SalesManagementService.currentPageSize"
    [currentPage]="SalesManagementService.currentPage"
    [totalItems]="SalesManagementService.ordersCount()"
    [statusConfig]="statusConfig"
    (selectionChange)="onSelectionChange($event)"
    (actionClick)="onActionClick($event)"
    (pageChange)="onPageChange($event)"
  />
}
